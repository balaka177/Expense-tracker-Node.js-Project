<!DOCTYPE html>
<html>
    <head> 
        <title>Expenses</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <script src="https://unpkg.com/axios@1.1.2/dist/axios.min.js"></script>
    </head>
    <body>  
        <div>
        <form class="container" onsubmit="expense_save(event)">
            <label>Item cost</label>
            <input type="number" name="cost" required>
            <label>Item description</label>
            <input type="text" name="desc" required>
            <label>Choose category</label>
            <select name="cate" required>n
                <option value="Vegetables">Vegetables</option>
                <option value="Fuel">Fuel</option>
                <option value="Snacks">Snacks</option>
                <option value="Bill">Bill</option>
                <option value="Meat">Meat</option>
            </select>
            <input type="submit" value="Add Expense">
        </form>
        <form class="container">
            <ul id="list">

            </ul>
        </form>
    </div>
    <script>
        
        window.addEventListener('DOMContentLoaded',async()=>{
            try{
            token=localStorage.getItem('token')
            await axios.get('http://localhost:8080/get_expenses',{headers:{'Authorization':token}})
            .then((res)=>{
                for(let i=0;i<res.data.exp.length;i++){
                    //console.log(res.data.exp[i])
                    showUserOnScreen(res.data.exp[i])
                }
            })
        }catch(err){
            console.log(err)
        }
        })
        function showUserOnScreen(exp){
            const parentEle=document.getElementById('list');
            const chiledEle=document.createElement('li');
            chiledEle.textContent=exp.cost +' -  '+ exp.description +' - '+ exp.category+'  ';
            parentEle.appendChild(chiledEle);
            const delButton=document.createElement('input');
            delButton.type='button';
            delButton.value='Delete';
            chiledEle.appendChild(delButton);
            delButton.onclick=async()=>{
                try{       
                    console.log('onclick')         
                const token=localStorage.getItem('token')
                await axios.delete(`http://localhost:8080/delete_expense/${exp.id}`,{headers:{'Authorization':token}})
                 .then((resp)=>{
                    parentEle.removeChild(chiledEle);
                 }).catch(err =>{
                    console.log(err)
                 })
                }catch(err){
                    console.log(err)
                }

            }
        }

        async function expense_save(e){
            try{
                //console.log('expense script')
               // e.preventDefault();
                const expenseDetails={
                 cost:e.target.cost.value,
                 description:e.target.desc.value,
                 category:e.target.cate.value,
                    }
                console.log(expenseDetails)
                const token=localStorage.getItem('token');
                const hi = await axios.post('http://localhost:8080/add_expense',expenseDetails,{headers: {'Authorization':token}})
            

                
            }catch(err){
                console.log(err);
            }
        }
    </script>
    </body>
</html>